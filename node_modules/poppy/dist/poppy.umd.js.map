{"version":3,"file":"poppy.umd.js","sources":["../node_modules/tackjs/dist/tackjs.es.js","../node_modules/tarry.js/dist/tarry.es.js","../index.js"],"sourcesContent":["function t(t){var o=t.getBoundingClientRect(),i=o.left,e=o.right,h=o.top,n=o.bottom,r=window.pageYOffset;return{height:n-h,width:e-i,top:{y:r+h,x:i+(e-i)/2},bottom:{y:r+n,x:i+(e-i)/2},left:{y:h+(n-h)/2,x:i},right:{y:h+(n-h)/2,x:e},topLeft:{y:r+h,x:i},bottomLeft:{y:r+n,x:i},topRight:{y:r+h,x:e},bottomRight:{y:r+n,x:e}}}function o(o,i,e){var h=t(i)[e],n=t(o),r=window.pageYOffset,d={top:r,bottom:r+window.innerHeight,left:0,right:window.innerWidth},g={top:{x:n.width/2,y:n.height},bottom:{x:n.width/2,y:0},left:{x:n.width,y:n.height/2},right:{x:0,y:n.height/2},topLeft:{x:n.width,y:n.height},topRight:{x:0,y:n.height},bottomLeft:{x:n.width,y:0},bottomRight:{x:0,y:0}},f=h.x-g[e].x,x=h.y-g[e].y;f<d.left?f=d.left:f+n.width>d.right&&(f=d.right-n.width),x<d.top?x=d.top:x+n.height>d.bottom&&(x=d.bottom-n.height),o.style.transform=\"translateX(\"+Math.round(f)+\"px) translateY(\"+Math.round(x)+\"px)\"}export default function(t,i,e){return t.classList.add(\"is-tacked\"),o(t,i,e),{update:function(){o(t,i,e)},destroy:function(){t.style.transform=\"\",t.classList.remove(\"is-tacked\")}}}\n//# sourceMappingURL=tackjs.es.js.map\n","function n(n){n.length>0&&n.shift().apply(this,n)}function t(t,e){t(),n(e)}function e(n,i){return function(){var u=[].slice.call(arguments),c=u[0];if(\"number\"==typeof c)return e(n,c);\"number\"==typeof i?setTimeout(function(){t(n,u)},i):t(n,u)}}function i(){var t=[].slice.call(arguments);return e(function(){n(t.slice(0))})}export{e as tarry,i as queue};\n//# sourceMappingURL=tarry.es.js.map\n","import tack from 'tackjs'\nimport { tarry, queue } from 'tarry.js'\n\nexport default class Popover {\n  constructor ({\n    target,\n    popover = null,\n    position = 'bottom',\n    transitionSpeed = 0,\n    onChange = null\n  }) {\n    this.target = target\n    this.popover = this.createPopover(popover)\n    this.position = position\n    this.transitionSpeed = transitionSpeed\n    this.onChange = onChange\n\n    this.state = {\n      pinned: false,\n      busy: false,\n      requestClose: false\n    }\n\n    this.pin = this.pin.bind(this)\n    this.unpin = this.unpin.bind(this)\n    this.block = this.block.bind(this)\n    this.unblock = this.unblock.bind(this)\n    this.isExternalClick = this.isExternalClick.bind(this)\n    this.handleKeyup = this.handleKeyup.bind(this)\n\n    this.focusNode = null\n  }\n\n  setState (state, cb) {\n    this.state = Object.assign(\n      this.state,\n      state\n    )\n\n    cb && tarry(cb, 0)()\n  }\n\n  block () {\n    this.setState({\n      busy: true\n    })\n  }\n\n  unblock () {\n    this.setState({\n      busy: false\n    }, () => {\n      this.state.requestClose && this.unpin()\n    })\n  }\n\n  toggle () {\n    this.state.pinned ? this.unpin() : this.pin()\n  }\n\n  pin () {\n    if (this.state.busy || this.state.pinned) return\n\n    this.setState({\n      busy: true\n    })\n\n    this.focusNode = document.activeElement\n\n    const render = tarry(() => document.body.appendChild(this.popover))\n    const pin = tarry(() => tack(this.popover, this.target, this.position))\n    const show = tarry(() => {\n      this.popover.classList.add('is-visible')\n      this.popover.setAttribute('tabindex', '0')\n      this.popover.setAttribute('aria-hidden', 'false')\n    })\n    const focus = tarry(() => this.popover.focus())\n    const done = tarry(() => this.setState({\n      busy: false,\n      pinned: true\n    }))\n\n    queue(render, pin, show(0), focus(0), done)()\n\n    this.popover.addEventListener('mouseenter', this.block)\n    this.popover.addEventListener('mouseleave', this.unblock)\n    window.addEventListener('click', this.isExternalClick)\n    window.addEventListener('touchstart', this.isExternalClick)\n    window.addEventListener('keyup', this.handleKeyup)\n    window.addEventListener('resize', this.unpin)\n\n    this.onChange && this.onChange({\n      pinned: true\n    })\n  }\n\n  unpin (force) {\n    this.setState({\n      requestClose: true\n    })\n\n    if (!force && (this.state.busy || !this.state.pinned)) return\n\n    tarry(() => {\n      this.setState({\n        busy: true\n      })\n\n      this.popover.removeEventListener('mouseenter', this.block)\n      this.popover.removeEventListener('mouseleave', this.unblock)\n      window.removeEventListener('click', this.isExternalClick)\n      window.removeEventListener('touchstart', this.isExternalClick)\n      window.removeEventListener('keyup', this.handleKeyup)\n      window.removeEventListener('resize', this.unpin)\n\n      const hide = tarry(() => this.popover.classList.add('is-hiding'))\n      const remove = tarry(() => document.body.removeChild(this.popover))\n      const blur = tarry(() => this.focusNode.focus())\n      const done = tarry(() => {\n        this.popover.classList.remove('is-hiding')\n        this.popover.classList.remove('is-visible')\n        this.setState({\n          busy: false,\n          pinned: false,\n          requestClose: false\n        })\n      })\n\n      queue(hide, remove(this.transitionSpeed), blur, done)()\n\n      this.onChange && this.onChange({\n        pinned: false\n      })\n    }, 0)()\n  }\n\n  handleKeyup (e) {\n    e.keyCode === 27 && this.unpin()\n  }\n\n  isExternalClick (e) {\n    if (\n      (e.target !== this.popover && !this.popover.contains(e.target)) &&\n      (e.target !== this.target && !this.target.contains(e.target))\n    ) {\n      this.unpin()\n    }\n  }\n\n  createPopover (pop) {\n    const popover = document.createElement('div')\n    popover.className = 'poppy'\n\n    popover.role = 'dialog'\n    popover.setAttribute('aria-label', 'Share Dialog')\n    popover.setAttribute('aria-hidden', 'true')\n\n    typeof pop === 'string' ? popover.innerHTML = pop : popover.appendChild(pop)\n\n    return popover\n  }\n}\n"],"names":["t","o","getBoundingClientRect","i","left","e","right","h","top","n","bottom","r","window","pageYOffset","height","width","y","x","topLeft","bottomLeft","topRight","bottomRight","d","innerHeight","innerWidth","g","f","style","transform","Math","round","length","shift","apply","this","u","slice","call","arguments","c","setTimeout","Popover","constructor","ref","target","popover","createPopover","position","transitionSpeed","onChange","state","pin","bind","unpin","block","unblock","isExternalClick","handleKeyup","focusNode","setState","cb","Object","assign","tarry","requestClose","toggle","pinned","busy","document","activeElement","render","body","appendChild","classList","add","update","destroy","remove","show","setAttribute","focus","done","queue","addEventListener","force","removeEventListener","hide","removeChild","blur","keyCode","contains","pop","createElement","className","role","innerHTML"],"mappings":"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"}